<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Login & Signup</title>
<link rel="stylesheet" href="styles.css">
</head>
<body>
<div class="container">
    <h2 id="form-title">Login</h2>
    <input id="username" placeholder="Username" />
    <input id="password" type="password" placeholder="Password" />
    <button onclick="submitForm()">Log In</button>
    <div class="toggle" onclick="toggleForm()">Don't have an account? Sign Up</div>
    <div class="message" id="message"></div>
</div>

<script>
    let isLogin = true;

    const usernameInput = document.getElementById('username');
    const passwordInput = document.getElementById('password');
    const formTitle = document.getElementById('form-title');
    const button = document.querySelector('button');
    const toggleText = document.querySelector('.toggle');
    const messageBox = document.getElementById('message');

    function toggleForm() {
        isLogin = !isLogin;
        formTitle.textContent = isLogin ? 'Login' : 'Sign Up';
        button.textContent = isLogin ? 'Log In' : 'Sign Up';
        toggleText.textContent = isLogin
            ? "Don't have an account? Sign Up"
            : 'Already have an account? Log In';
        clearMessage();
    }

    function showMessage(text, type = 'info') {
        messageBox.textContent = text;
        messageBox.style.color = type === 'error' ? '#c0392b' : '#2c3e50';
    }

    function clearMessage() {
        messageBox.textContent = '';
    }

    function validateInputs(username, password) {
    if (!username || !password) {
        showMessage('Please fill in all fields.', 'error');
        return false;
    }
    if (username.length < 3 || password.length < 4) {
        showMessage('Username or password is too short.', 'error');
        return false;
    }
    return true;
    }

    async function submitForm() {
        const username = usernameInput.value.trim();
        const password = passwordInput.value;

        if (!validateInputs(username, password)) return;

        showMessage('Please wait...', 'info');

        const endpoint = isLogin ? 'login' : 'signup';

        try {
        const response = await fetch(`http://localhost:3000/${endpoint}`, {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ username, password })
        });

        const data = await response.json();

        if (response.ok) {
            if (data.message === 'success') {
                showMessage('Login successful! Redirecting...');
                setTimeout(() => {
                window.location.href = 'dashboard.html';
                }, 1000);
            } else {
                showMessage(data.message, 'info');
            }
        } else {
        showMessage(data.message || 'Something went wrong.', 'error');
        }

        } catch (err) {
        console.error(err);
        showMessage('Network error. Please try again later.', 'error');
        }
    }
    </script>
</body>
</html>